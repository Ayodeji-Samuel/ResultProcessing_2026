{% extends "base.html" %}

{% block title %}Profile - Result Processing System{% endblock %}

{% block content %}
<!-- Profile Header -->
<div class="bg-gradient-to-r from-primary-600 to-primary-700 rounded-xl shadow-lg p-8 mb-8 text-white">
    <div class="flex items-center">
        <div class="bg-white bg-opacity-20 rounded-full p-6 mr-6">
            <i class="ri-user-line text-6xl"></i>
        </div>
        <div class="flex-1">
            <h1 class="text-3xl font-bold mb-2">{{ user.full_name }}</h1>
            <p class="text-primary-100 mb-3">{{ user.username }}</p>
            <div class="flex space-x-3">
                {% if user.role == 'admin' %}
                <span class="px-4 py-2 bg-white bg-opacity-20 rounded-full text-sm font-medium flex items-center">
                    <i class="ri-admin-line mr-2"></i>Administrator
                </span>
                {% elif user.role == 'hod' %}
                <span class="px-4 py-2 bg-white bg-opacity-20 rounded-full text-sm font-medium flex items-center">
                    <i class="ri-vip-crown-line mr-2"></i>Head of Department
                </span>
                {% elif user.role == 'level_adviser' %}
                <span class="px-4 py-2 bg-white bg-opacity-20 rounded-full text-sm font-medium flex items-center">
                    <i class="ri-user-star-line mr-2"></i>Level Adviser
                </span>
                {% else %}
                <span class="px-4 py-2 bg-white bg-opacity-20 rounded-full text-sm font-medium flex items-center">
                    <i class="ri-user-line mr-2"></i>Lecturer
                </span>
                {% endif %}
                {% if user.is_active %}
                <span class="px-4 py-2 bg-green-500 bg-opacity-80 rounded-full text-sm font-medium flex items-center">
                    <i class="ri-checkbox-circle-line mr-2"></i>Active
                </span>
                {% endif %}
            </div>
        </div>
        <a href="{{ url_for('auth.change_password') }}" 
           class="px-6 py-3 bg-white text-primary-600 rounded-lg hover:bg-gray-100 transition-colors font-medium flex items-center">
            <i class="ri-key-line mr-2"></i>
            Change Password
        </a>
    </div>
</div>

<!-- Profile Content -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <!-- Account Information -->
    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
        <div class="bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-4 text-white">
            <h2 class="text-xl font-bold flex items-center">
                <i class="ri-user-settings-line mr-2"></i>
                Account Information
            </h2>
        </div>
        <div class="p-6">
            <div class="space-y-4">
                <div class="flex items-center pb-4 border-b border-gray-200">
                    <div class="w-1/3">
                        <p class="text-sm font-semibold text-gray-600">Username</p>
                    </div>
                    <div class="w-2/3">
                        <p class="text-sm text-gray-900">{{ user.username }}</p>
                    </div>
                </div>
                <div class="flex items-center pb-4 border-b border-gray-200">
                    <div class="w-1/3">
                        <p class="text-sm font-semibold text-gray-600">Full Name</p>
                    </div>
                    <div class="w-2/3">
                        <p class="text-sm text-gray-900">{{ user.full_name }}</p>
                    </div>
                </div>
                <div class="flex items-center pb-4 border-b border-gray-200">
                    <div class="w-1/3">
                        <p class="text-sm font-semibold text-gray-600">Email</p>
                    </div>
                    <div class="w-2/3">
                        <p class="text-sm text-gray-900">{{ user.email }}</p>
                    </div>
                </div>
                <div class="flex items-center pb-4 border-b border-gray-200">
                    <div class="w-1/3">
                        <p class="text-sm font-semibold text-gray-600">Role</p>
                    </div>
                    <div class="w-2/3">
                        {% if user.role == 'admin' %}
                        <span class="px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-xs font-bold">
                            Administrator
                        </span>
                        {% elif user.role == 'hod' %}
                        <span class="px-3 py-1 bg-indigo-100 text-indigo-800 rounded-full text-xs font-bold">
                            Head of Department
                        </span>
                        {% elif user.role == 'level_adviser' %}
                        <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-bold">
                            Level Adviser
                        </span>
                        {% else %}
                        <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs font-bold">
                            Lecturer
                        </span>
                        {% endif %}
                    </div>
                </div>
                {% if user.program %}
                <div class="flex items-center pb-4 border-b border-gray-200">
                    <div class="w-1/3">
                        <p class="text-sm font-semibold text-gray-600">Assigned Program</p>
                    </div>
                    <div class="w-2/3">
                        <span class="px-3 py-1 bg-gray-100 text-gray-800 rounded text-xs font-medium">{{ user.program }}</span>
                    </div>
                </div>
                {% endif %}
                {% if user.level %}
                <div class="flex items-center pb-4 border-b border-gray-200">
                    <div class="w-1/3">
                        <p class="text-sm font-semibold text-gray-600">Assigned Level</p>
                    </div>
                    <div class="w-2/3">
                        <span class="px-3 py-1 bg-gray-100 text-gray-800 rounded text-xs font-medium">{{ user.level }} Level</span>
                    </div>
                </div>
                {% endif %}
                <div class="flex items-center">
                    <div class="w-1/3">
                        <p class="text-sm font-semibold text-gray-600">Status</p>
                    </div>
                    <div class="w-2/3">
                        {% if user.is_active %}
                        <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium flex items-center w-fit">
                            <i class="ri-checkbox-circle-line mr-1"></i>Active
                        </span>
                        {% else %}
                        <span class="px-3 py-1 bg-gray-100 text-gray-800 rounded-full text-xs font-medium flex items-center w-fit">
                            <i class="ri-close-circle-line mr-1"></i>Inactive
                        </span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Activity -->
    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
        <div class="bg-gradient-to-r from-green-600 to-green-700 px-6 py-4 text-white">
            <h2 class="text-xl font-bold flex items-center">
                <i class="ri-time-line mr-2"></i>
                Login Activity
            </h2>
        </div>
        <div class="p-6">
            <div class="space-y-4">
                <div class="flex items-center pb-4 border-b border-gray-200">
                    <div class="w-1/3">
                        <p class="text-sm font-semibold text-gray-600">Last Login</p>
                    </div>
                    <div class="w-2/3">
                        {% if user.last_login %}
                        <p class="text-sm text-gray-900">{{ user.last_login.strftime('%Y-%m-%d %H:%M:%S') }}</p>
                        {% else %}
                        <p class="text-sm text-gray-400">Never logged in</p>
                        {% endif %}
                    </div>
                </div>
                <div class="flex items-center pb-4 border-b border-gray-200">
                    <div class="w-1/3">
                        <p class="text-sm font-semibold text-gray-600">Last IP</p>
                    </div>
                    <div class="w-2/3">
                        {% if user.last_login_ip %}
                        <p class="text-sm font-mono text-gray-900">{{ user.last_login_ip }}</p>
                        {% else %}
                        <p class="text-sm text-gray-400">-</p>
                        {% endif %}
                    </div>
                </div>
                <div class="flex items-center pb-4 border-b border-gray-200">
                    <div class="w-1/3">
                        <p class="text-sm font-semibold text-gray-600">Failed Attempts</p>
                    </div>
                    <div class="w-2/3">
                        <span class="px-3 py-1 {{ 'bg-red-100 text-red-800' if user.failed_login_attempts > 0 else 'bg-green-100 text-green-800' }} rounded-full text-xs font-bold">
                            {{ user.failed_login_attempts }}
                        </span>
                    </div>
                </div>
                <div class="flex items-center pb-4 border-b border-gray-200">
                    <div class="w-1/3">
                        <p class="text-sm font-semibold text-gray-600">Account Created</p>
                    </div>
                    <div class="w-2/3">
                        <p class="text-sm text-gray-900">{{ user.created_at.strftime('%Y-%m-%d') }}</p>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-1/3">
                        <p class="text-sm font-semibold text-gray-600">Security Status</p>
                    </div>
                    <div class="w-2/3 space-y-2">
                        {% if user.is_locked or (user.locked_until and user.locked_until > now) %}
                        <span class="px-3 py-1 bg-red-100 text-red-800 rounded-full text-xs font-medium flex items-center w-fit">
                            <i class="ri-lock-line mr-1"></i>Account Locked
                        </span>
                        {% endif %}
                        {% if user.must_change_password %}
                        <span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs font-medium flex items-center w-fit">
                            <i class="ri-key-line mr-1"></i>Password Change Required
                        </span>
                        {% endif %}
                        {% if not user.is_locked and not user.must_change_password %}
                        <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium flex items-center w-fit">
                            <i class="ri-shield-check-line mr-1"></i>Secure
                        </span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
