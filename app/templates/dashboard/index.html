{% extends "base.html" %}

{% block title %}Dashboard - Result Processing System{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">Dashboard</h1>
    <div class="flex items-center space-x-3">
        <p class="text-gray-600">Welcome back, <span class="font-semibold">{{ current_user.full_name }}</span>!</p>
        {% if current_session %}
        <span class="px-3 py-1 bg-primary-100 text-primary-700 rounded-full text-sm font-medium">
            {{ current_session.session_name }}
        </span>
        {% endif %}
    </div>
</div>

{% if not current_session %}
<div class="bg-yellow-50 border-l-4 border-yellow-400 px-6 py-4 mb-8 rounded-r-lg">
    <div class="flex items-start">
        <i class="ri-error-warning-line text-yellow-500 text-2xl mr-4 mt-0.5"></i>
        <div>
            <p class="font-semibold text-yellow-800">No Active Session!</p>
            <p class="text-yellow-700 mt-1">Please <a href="{{ url_for('dashboard.sessions') }}" class="underline hover:text-yellow-900">set a current academic session</a> to begin.</p>
        </div>
    </div>
</div>
{% endif %}

<!-- Statistics Cards -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <!-- Students Card -->
    <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl shadow-lg overflow-hidden group hover:shadow-xl transition-shadow">
        <div class="p-6 text-white">
            <div class="flex items-center justify-between mb-4">
                <div class="bg-white/20 backdrop-blur-sm rounded-lg p-3">
                    <i class="ri-user-line text-3xl"></i>
                </div>
                <div class="text-right">
                    <p class="text-5xl font-bold">{{ stats.total_students }}</p>
                    <p class="text-blue-100 text-sm mt-1">Students</p>
                </div>
            </div>
        </div>
        <a href="{{ url_for('students.index') }}" class="block bg-white/10 backdrop-blur-sm px-6 py-3 text-white hover:bg-white/20 transition-colors">
            <span class="flex items-center justify-between text-sm font-medium">
                View Students
                <i class="ri-arrow-right-line"></i>
            </span>
        </a>
    </div>

    <!-- Courses Card -->
    <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl shadow-lg overflow-hidden group hover:shadow-xl transition-shadow">
        <div class="p-6 text-white">
            <div class="flex items-center justify-between mb-4">
                <div class="bg-white/20 backdrop-blur-sm rounded-lg p-3">
                    <i class="ri-book-open-line text-3xl"></i>
                </div>
                <div class="text-right">
                    <p class="text-5xl font-bold">{{ stats.total_courses }}</p>
                    <p class="text-green-100 text-sm mt-1">Courses</p>
                </div>
            </div>
        </div>
        <a href="{{ url_for('courses.index') }}" class="block bg-white/10 backdrop-blur-sm px-6 py-3 text-white hover:bg-white/20 transition-colors">
            <span class="flex items-center justify-between text-sm font-medium">
                View Courses
                <i class="ri-arrow-right-line"></i>
            </span>
        </a>
    </div>

    <!-- Results Card -->
    <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl shadow-lg overflow-hidden group hover:shadow-xl transition-shadow">
        <div class="p-6 text-white">
            <div class="flex items-center justify-between mb-4">
                <div class="bg-white/20 backdrop-blur-sm rounded-lg p-3">
                    <i class="ri-file-chart-line text-3xl"></i>
                </div>
                <div class="text-right">
                    <p class="text-5xl font-bold">{{ stats.total_results }}</p>
                    <p class="text-purple-100 text-sm mt-1">Results</p>
                </div>
            </div>
        </div>
        <a href="{{ url_for('results.index') }}" class="block bg-white/10 backdrop-blur-sm px-6 py-3 text-white hover:bg-white/20 transition-colors">
            <span class="flex items-center justify-between text-sm font-medium">
                View Results
                <i class="ri-arrow-right-line"></i>
            </span>
        </a>
    </div>

    <!-- Users Card (HoD Only) -->
    {% if current_user.role == 'hod' %}
    <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl shadow-lg overflow-hidden group hover:shadow-xl transition-shadow">
        <div class="p-6 text-white">
            <div class="flex items-center justify-between mb-4">
                <div class="bg-white/20 backdrop-blur-sm rounded-lg p-3">
                    <i class="ri-team-line text-3xl"></i>
                </div>
                <div class="text-right">
                    <p class="text-5xl font-bold">{{ stats.total_users }}</p>
                    <p class="text-orange-100 text-sm mt-1">Users</p>
                </div>
            </div>
        </div>
        <a href="{{ url_for('auth.users') }}" class="block bg-white/10 backdrop-blur-sm px-6 py-3 text-white hover:bg-white/20 transition-colors">
            <span class="flex items-center justify-between text-sm font-medium">
                Manage Users
                <i class="ri-arrow-right-line"></i>
            </span>
        </a>
    </div>
    {% endif %}
</div>

<!-- Quick Actions -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
    <div class="lg:col-span-2">
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                <i class="ri-flashlight-line text-primary-600 mr-2"></i>
                Quick Actions
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <a href="{{ url_for('students.upload') }}" class="group flex items-center p-4 border-2 border-gray-200 rounded-lg hover:border-primary-500 hover:shadow-md transition-all">
                    <div class="bg-blue-100 rounded-lg p-3 mr-4 group-hover:bg-blue-200 transition-colors">
                        <i class="ri-upload-cloud-line text-blue-600 text-2xl"></i>
                    </div>
                    <div>
                        <p class="font-semibold text-gray-900">Upload Students</p>
                        <p class="text-sm text-gray-500">Import student data</p>
                    </div>
                </a>
                
                <a href="{{ url_for('results.upload') }}" class="group flex items-center p-4 border-2 border-gray-200 rounded-lg hover:border-primary-500 hover:shadow-md transition-all">
                    <div class="bg-green-100 rounded-lg p-3 mr-4 group-hover:bg-green-200 transition-colors">
                        <i class="ri-file-upload-line text-green-600 text-2xl"></i>
                    </div>
                    <div>
                        <p class="font-semibold text-gray-900">Upload Results</p>
                        <p class="text-sm text-gray-500">Import course results</p>
                    </div>
                </a>
                
                <a href="{{ url_for('reports.spreadsheet') }}" class="group flex items-center p-4 border-2 border-gray-200 rounded-lg hover:border-primary-500 hover:shadow-md transition-all">
                    <div class="bg-purple-100 rounded-lg p-3 mr-4 group-hover:bg-purple-200 transition-colors">
                        <i class="ri-file-pdf-line text-purple-600 text-2xl"></i>
                    </div>
                    <div>
                        <p class="font-semibold text-gray-900">Generate Spreadsheet</p>
                        <p class="text-sm text-gray-500">Create PDF reports</p>
                    </div>
                </a>
                
                {% if current_user.role == 'hod' %}
                <a href="{{ url_for('auth.create_user') }}" class="group flex items-center p-4 border-2 border-gray-200 rounded-lg hover:border-primary-500 hover:shadow-md transition-all">
                    <div class="bg-orange-100 rounded-lg p-3 mr-4 group-hover:bg-orange-200 transition-colors">
                        <i class="ri-user-add-line text-orange-600 text-2xl"></i>
                    </div>
                    <div>
                        <p class="font-semibold text-gray-900">Add User</p>
                        <p class="text-sm text-gray-500">Create user account</p>
                    </div>
                </a>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Info Card -->
    <div class="bg-gradient-to-br from-primary-500 to-blue-600 rounded-xl shadow-lg p-6 text-white">
        <h3 class="text-lg font-bold mb-4 flex items-center">
            <i class="ri-information-line mr-2"></i>
            System Information
        </h3>
        <div class="space-y-3">
            <div class="flex items-start">
                <i class="ri-shield-check-line text-xl mr-3 mt-0.5"></i>
                <div>
                    <p class="font-medium text-sm">Security Status</p>
                    <p class="text-primary-100 text-xs mt-1">All systems operational</p>
                </div>
            </div>
            <div class="flex items-start">
                <i class="ri-user-star-line text-xl mr-3 mt-0.5"></i>
                <div>
                    <p class="font-medium text-sm">Your Role</p>
                    <p class="text-primary-100 text-xs mt-1">
                        {{ 'Head of Department' if current_user.role == 'hod' else 'Level Adviser' }}
                    </p>
                </div>
            </div>
            {% if current_user.program %}
            <div class="flex items-start">
                <i class="ri-bookmark-line text-xl mr-3 mt-0.5"></i>
                <div>
                    <p class="font-medium text-sm">Program</p>
                    <p class="text-primary-100 text-xs mt-1">{{ current_user.program }}</p>
                </div>
            </div>
            {% endif %}
            {% if current_user.level %}
            <div class="flex items-start">
                <i class="ri-star-line text-xl mr-3 mt-0.5"></i>
                <div>
                    <p class="font-medium text-sm">Level</p>
                    <p class="text-primary-100 text-xs mt-1">{{ current_user.level }} Level</p>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Charts Section (HoD Only) -->
{% if current_user.role == 'hod' and (students_by_program or students_by_level) %}
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    {% if students_by_program %}
    <div class="bg-white rounded-xl shadow-lg p-6">
        <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
            <i class="ri-pie-chart-line text-primary-600 mr-2"></i>
            Students by Program
        </h3>
        <div class="space-y-3">
            {% for program, count in students_by_program %}
            <div>
                <div class="flex items-center justify-between mb-1">
                    <span class="text-sm font-medium text-gray-700">{{ program }}</span>
                    <span class="text-sm font-bold text-primary-600">{{ count }}</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="bg-gradient-to-r from-primary-500 to-blue-500 h-2 rounded-full" 
                         style="width: {{ (count / students_by_program|sum(attribute='1') * 100)|round }}%"></div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    {% if students_by_level %}
    <div class="bg-white rounded-xl shadow-lg p-6">
        <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
            <i class="ri-bar-chart-line text-primary-600 mr-2"></i>
            Students by Level
        </h3>
        <div class="space-y-3">
            {% for level, count in students_by_level %}
            <div>
                <div class="flex items-center justify-between mb-1">
                    <span class="text-sm font-medium text-gray-700">{{ level }} Level</span>
                    <span class="text-sm font-bold text-green-600">{{ count }}</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="bg-gradient-to-r from-green-500 to-emerald-500 h-2 rounded-full" 
                         style="width: {{ (count / students_by_level|sum(attribute='1') * 100)|round }}%"></div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endif %}
{% endblock %}
